<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=p, initial-scale=1.0">
    <title>Document</title>
</head>
<body>

    <div id="topo" style="width: 100%;">
        <p id="success">Login: false</p>
        <p id="message">Insira user e password</p>
    </div>
    


    <input type="text" id="name">
    <br>
    <input type="password" id="password">


    <br>
    <button onclick="login()" >login</button>
    <button onclick='location.replace("http://localhost:3000/logout")' >logout</button>

    <div>
        <pre id="txtData"></pre>
    </div>
    <button onclick='fetchData("http://localhost:3000/tarefas")' >get tarefas</button>
    <button onclick='fetchData("http://localhost:3000/festas")' >get festas</button>
</body>

<style>
    #txtData {
        margin: 30px 0 0 0;
        padding: 30px;
        border: solid 1px black;
    }
</style>

<script>

var topo = document.getElementById("topo")
var success = document.getElementById("success")
var message = document.getElementById("message")
var txtData = document.getElementById("txtData")



function login() {
    var name = document.getElementById("name")
    var password = document.getElementById("password")
    fetch('http://localhost:3000/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        credentials: "same-origin",
        body: JSON.stringify({ name: name.value, password: password.value})
    })
    .then( response => response.json())
    .then( data => {

        if ( data.success === true) {
            topo.style.backgroundColor = "green"
            success.innerHTML = "Login: " + data.success
            message.innerHTML = data.message
            fetchData('http://localhost:3000/tarefas')
        } else {
            topo.style.backgroundColor = "red"
            success.innerHTML = "Login: " + data.success
            message.innerHTML = data.message
        }
        
        
    })
    name.value = ""
    password.value = ""
}

function fetchData(url) {
    fetch( url, {
        credentials: "same-origin",
    })
    .then( response => response.json())
    .then( data => {
        if ( data.success === false) {
            topo.style.backgroundColor = "red"
            success.innerHTML = "Login: " + data.success
            message.innerHTML = "Inicie sessÃ£o"
            txtData.innerHTML = ""
        } else {
            success.innerHTML = "Login: " + data.success
            txtData.innerHTML = JSON.stringify(data)
            //data.map(f => console.log(f.nomeFesta))
        }
         
    })
    .catch( error => {
        txtData.innerHTML = ` erro na rede ${error}`
    })
}

fetchData('http://localhost:3000/tarefas')

</script>
</html>